FROM node:24.13.0-alpine3.22@sha256:6f96670faefc1ec23520ce30e453e85bfdb94a43b49b7aac2b0d3ac3a902bf2f

ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

VOLUME ["/pnpm/store"]
VOLUME ["/web/node_modules"]
VOLUME ["/web"]
VOLUME ["/web/.pnpm-store"]

WORKDIR /web

CMD ["sh", "-c", "pnpm install --frozen-lockfile; pnpm run build; node dist/index.js"]
